!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var n={exports:{}};e(n.exports),t.stateM=n.exports}}(this,function(t){"use strict";function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function u(t){var e="function"==typeof Map?new Map:void 0;return(u=function(t){function n(){return f(t,arguments,p(this).constructor)}if(null===t||!h(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,t)})(t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function f(t,e,n){return(f=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&l(i,n.prototype),i}).apply(null,arguments)}function h(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.State=t.StateManager=void 0;var y=function(t){function e(t){var n;return i(this,e),"function"!=typeof(n=o(this,p(e).call(this,t))).diff&&Object.assign(a(n),d),n}return s(e,u(URLSearchParams)),e}();t.State=y;var d={diff:function(t){var e=Object.assign(this.toPlainObject(),t.toPlainObject()),n={editedKeys:[],deletedKeys:[],newKeys:[],changedKeys:[]},r=this;for(var i in e)null==t.get(i)?(n.deletedKeys.push(i),n.changedKeys.push(i)):null==r.get(i)?(n.newKeys.push(i),n.changedKeys.push(i)):r.get(i)!==t.get(i)&&(n.editedKeys.push(i),n.changedKeys.push(i));return n},isEqual:function(t){return this.toString().length==t.toString().length&&0==this.diff(t).changedKeys.length},toPlainObject:function(){var t={};return this.forEach(function(e,n){t[n]=e}),t},update:function(t){var e=new y(t).toPlainObject();for(var n in e){var r=n,i=e[n];this.set(r,i)}}};Object.assign(y.prototype,d);var v=function(){function t(e){i(this,t),window.addEventListener("hashchange",this),window.addEventListener("popstate",this),"string"==typeof e?this.url=new URL(e):e instanceof URLSearchParams?this.state=new y(e.toString()):e instanceof Object&&(this.state=new y(e))}return n(t,[{key:"handleEvent",value:function(t){"popstate"==t.type&&t.state?this.state=new y(t.state):this.url=new URL(window.location.href)}},{key:"update",value:function(t){var e=new y(this.state);e.update(t),this.state=e}},{key:"stateToUrl",value:function(t){var e=new URL(this._url?this._url.href:window.location.href),n=new y(t.toString());return null!=n.get("hash")&&(e.hash=n.get("hash"),n.delete("hash")),null!=n.get("pathname")&&(e.pathname=n.get("pathname"),n.delete("pathname")),e.search="?"+n.toString().replace(/\+/gi,"%20"),e}},{key:"urlToState",value:function(t){var e=new y(t.searchParams,function(){});return e.append("hash",t.hash),e.append("pathname",t.pathname),e}},{key:"onstatechange",value:function(t){var e,n=this.state;e=(this._prevStateString?new y(this._prevStateString):new y).diff(n),t||history.pushState(n.toPlainObject(),document?document.head.title:"",this.url.href);var r=new CustomEvent("statechange",{detail:{newState:n,diff:e,stateManager:this}});window.dispatchEvent(r)}},{key:"cleanUp",value:function(){window.removeEventListener("hashchange",this),window.removeEventListener("popstate",this)}},{key:"url",set:function(t){if(!this._url||this._url.href!=t.href){var e=void 0===this._url;this._url=t,this.state=this.urlToState(t),this.onstatechange(e)}},get:function(){return this._url}},{key:"state",set:function(t){if(void 0===this._state||!this._state.isEqual(t)){this._state&&(this._prevStateString=this._state.toString()),this._state=t;var e=this.stateToUrl(t);void 0!==this._url&&e.href==this._url.href||(this.url=e)}},get:function(){return this._state}}]),t}();t.StateManager=v});
//# sourceMappingURL=state.min.js.map