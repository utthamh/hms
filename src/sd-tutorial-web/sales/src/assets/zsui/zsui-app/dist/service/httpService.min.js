!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./service.m.js"],t);else if("undefined"!=typeof exports)t(exports,require("./service.m.js"));else{var r={exports:{}};t(r.exports,e.serviceM),e.httpServiceM=r.exports}}(this,function(e,t){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?a(e):t}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=function(e){return e&&e.__esModule?e:{default:e}}(t);var c=function(e){function r(e){var t;return n(this,r),t=s(this,o(r).call(this)),t.params=e,t}return h(r,t.default),u(r,[{key:"xhr",get:function(){if(this._xhr)return this._xhr;var e=new XMLHttpRequest;return e.addEventListener("loadstart",this),e.addEventListener("load",this),e.addEventListener("loadend",this),e.addEventListener("progress",this),e.addEventListener("error",this),e.addEventListener("abort",this),this._xhr=e,this._xhr}}]),u(r,[{key:"response",value:function(e){if(e)switch(e.responseType){case"json":return e.response;case"text":case"":try{return JSON.parse(e.responseText)}catch(t){return e.responseText}default:return this.xhr.response}}},{key:"handleEvent",value:function(e){if("load"==e.type)this.xhr.status>=200&&this.xhr.status<300?this.resolve(this.response(this.xhr)):((t=new Error("Response error "+this.xhr.status)).xhr=this.xhr,this.reject(t));else if("abort"==e.type)(t=new Error("Request aborted")).xhr=this.xhr,this.reject(t);else if("error"==e.type){var t=new Error("Bad request");t.xhr=this.xhr,this.reject(t)}}},{key:"requestBody",value:function(e){if(e.body){if("string"==typeof e.body)return e.body;var t=new FormData;for(var r in e.body)t.append(r,e.body[r]);return t}}},{key:"abort",value:function(){this.xhr.abort()}},{key:"requestHeaders",value:function(e,t){if(t.headers)for(var r in t.headers){var n=t.headers[r];e.setRequestHeader(r.toLowerCase(),n.toString().trim())}}},{key:"requestUrl",value:function(e){var t=new URL(e.url);if(e.path){var r=t.pathname;for(var n in e.path)r+="/"+encodeURIComponent(n)+"/"+encodeURIComponent(e.path[n]);t.pathname=r.replace("//","/").replace("\\/","/")}if(e.query){var s=t.searchParams;for(var a in e.query)s.append(a,e.query[a]);t.search=s.toString()}return t.href}},{key:"send",value:function(){var e=this.xhr,t=this.params,r=this.requestUrl(t),n=t.method||"GET";0==e.readyState||4==e.readyState?(e.open(n,r),this.requestHeaders(e,t),e.send(this.requestBody(t))):this.reject(new Error("Still running"))}},{key:"applyParams",value:function(e){var t=Object.assign(Object.create(e||{}),e);this.params=this.params||{},t.query&&(this.params.query=this.params.query||{},Object.assign(this.params.query,t.query),delete t.query),t.path&&(this.params.path=this.params.path||{},Object.assign(this.params.path,t.path),delete t.path),t.headers&&(this.params.headers=this.params.headers||{},Object.assign(this.params.headers,t.headers),delete t.headers),t.body&&(this.params.body=this.params.body||{},Object.assign(this.params.body,t.body),delete t.body),Object.assign(this.params,t)}},{key:"executor",get:function(){var e=this;return function(t,r,n){e.applyParams(t),e.resolve=r,e.reject=n,e.send()}}}]),r}();e.default=c});
//# sourceMappingURL=httpService.min.js.map