!function(p){"use strict";var o={emptyText:"Select value",addCheckboxes:!1,maxOptionsVisible:100,minOptionsForSearch:6,addSelectAll:!1,selectAllText:"Select all",deselectAllText:"Deselect all",events:{},match:function(t,e,i){return!!(t&&e&&t.text)&&(!!t.group||(i?t.text.indexOf(e):-1!=t.text.toLowerCase().indexOf(e.toLowerCase())))},flippable:!1,hideOnScroll:!1,defaultInputFocus:!0,updateOverlayText:function(t){t||(t=this.options.emptyText),t=t.replace(new RegExp("&#160;","g"),""),this.$overlay.text(t)}};function c(t){return!(!t||!t.length)}function s(t,e){if(this.$select=e,this.configure(t),this._allSelected=!1,this.options.addSelectAll&&!this.options.multiple)throw new Error("addSelectAll is available in multiple mode only");this.options.addSelectAll&&999<this.$select[0].length&&console.warn("We do not recommend to use addSelectAll with a long list of options due to possible lack of performance"),this.options.noRender||this.render()}s.prototype.optionMouseOverBind=function(t){if(this.options.alwaysOpen)this.selectOption(null,!1);else{var e=p(t.target);this.selectOption(e,!1)}},s.prototype.readOptions=function(){var t;if(c(this.$select)&&this.$select[0].options){this.data=[],this.$nav.html("");var e=0;for(t=0;t<this.$select[0].children.length;t++){var i=this.$select[0].children[t];if("optgroup"===i.tagName.toLowerCase()){this.data.push({text:i.getAttribute("label"),value:i.getAttribute("value"),group:!0});for(var s=0;s<i.children.length;s++)this.data.push({id:e++,text:i.children[s].text,value:i.children[s].value,optgroupItem:!0})}else this.data.push({id:e++,text:i.text,value:i.value,isDisabled:i.hasAttribute("disabled"),isPlaceholder:i.hasAttribute("placeholder")})}this.renderOptions({data:this.data}),this.$select[0].options.length>=this.options.minOptionsForSearch&&this.$container.css("minHeight",this.$container.outerHeight()),this.$select[0].options.length>=this.options.minOptionsForSearch?(this.$input.parent().show(),this.$container.css("minHeight",this.$container.css("height"))):this.$input.parent().hide()}},s.prototype.renderOptions=function(t){this.$nav.off("scroll"),this.$nav.children("a").off("focus");var e,i=t.data||[],s=t.start||0,n=t.highlight,o=t.selectFirst,h=s+(i.length<this.options.maxOptionsVisible?i.length:this.options.maxOptionsVisible);this.options.addSelectAll&&0===s&&!n&&((e=this.options.addCheckboxes?p('<a href="javascript:void(0)"><span class="zs-checkbox"><input type="checkbox"><span zs-dropdown-option></span></span></a>'):p('<a href="javascript:void(0)"><span zs-dropdown-option></span></a>')).find("[zs-dropdown-option]").text(this.options.selectAllText),this.selectedMap&&Object.keys(this.selectedMap).length===this.data.length&&e.find("input").prop("checked",!0),e.addClass("select-all"),e.on("click touch",this.toggleAll.bind(this)),e.appendTo(this.$nav));for(var a=s;a<h&&i[a];a++){var l="";void 0!==i[a].id&&(l='index="'+i[a].id+'"'),(e=this.options.addCheckboxes&&!i[a].group?p('<a href="javascript:void(0)" '+l+'><span class="zs-checkbox"><input type="checkbox"><span zs-dropdown-option></span></span></a>'):p('<a href="javascript:void(0)" '+l+"><span zs-dropdown-option></span></a>")).find("[zs-dropdown-option]").text(i[a].text),i[a].optgroupItem&&e.attr("indent-text",""),i[a].isDisabled&&e.attr("disabled",""),i[a].isPlaceholder&&(e.attr("placeholder",""),e.hide()),e.appendTo(this.$nav),l&&(e.on("click touch",this.optionClick.bind(this)),e.on("mouseover",this.optionMouseOverBind.bind(this))),n&&!i[a].group&&this.highlight(!0,e,n),this.options.multiple?this.selectedMap&&void 0!==this.selectedMap[i[a].id]&&(e.attr("active",""),e.find("input").prop("checked",!0)):this.$select[0].selectedIndex===i[a].id&&(e.attr("active",""),e.find("input").prop("checked",!0))}if(s<1&&this.$nav.scrollTop(0),o&&this.selectOption(this.$nav.children("a[index]").first(),!0),!(h>=i.length)){var c=this.renderOptions.bind(this,{data:i,start:h,highlight:n});this.$nav.on("scroll",function(){p(this).scrollTop()+p(this).innerHeight()<p(this)[0].scrollHeight-10||c()}),this.$nav.children("a:last").on("focus",function(){c()})}},s.prototype.selectOption=function(t,e){if(c(this.$selected)&&(this.$selected.removeAttr("hover"),this.$selected=null),c(t)){if(this.$selected=t,this.$selected.attr("hover",""),window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.match(/iPad/i))return;e&&(t.focus(),this.$input.focus().val(this.$input.val()))}else;},s.prototype.choseOption=function(t){var e,i;this.options.multiple||this.$nav.find(">[active]").removeAttr("active"),!c(t)||(i=t.find("input"),t.attr("active",""),e=t.attr("index"),this.options.multiple?(this.mapSelection(t.attr("index")),void 0!==this.selectedMap[e]?(t.attr("active",""),i.prop("checked",!0)):(t.removeAttr("active"),i.prop("checked",!1))):(this.selectOption(t,!1),this.$select[0].selectedIndex=e),this.options.alwaysOpen||this.$select.trigger("change"),"function"==typeof this.options.events.change&&this.options.events.change.call(this),this.options.multiple)},s.prototype.activateOption=function(t,e){var i=this.locateOption(t);this.options.multiple?this.mapSelection(i.attr("index"),!0):this.$nav.find(">[active]").removeAttr("active"),c(i)&&(i.attr("active",""),e&&i.focus())},s.prototype.isInViewPort=function(t){return t<p(window).scrollTop()+p(window).height()},s.prototype.getRightViewPortDelta=function(t){return t-(p(window).scrollLeft()+p(window).width())},s.prototype.calculateFlipPosition=function(){var t,e=this,i=e.$container.outerWidth(),s=e.$container.outerHeight(),n=e.$overlay.offset(),o=p(document).scrollTop(),h=n.left-p(document).scrollLeft();e.$parentModal=e.$container.parents(".zs-modal"),t=this.isInViewPort(n.top+s)?n.top-o:n.top+e.$overlay.outerHeight()-s-o;var a=this.getRightViewPortDelta(n.left+i);if(0<=a&&(h-=a),e.$parentModal.length&&"none"!=e.$parentModal.css("transform")){var l=e.$parentModal.offset(),c=e.$parentModal[0].style.width;c?e.removeModalWidthOnHide=!1:(e.removeModalWidthOnHide=!0,c=e.$parentModal.css("width")),e.$parentModal.css({transform:"none",top:l.top-o+"px",left:l.left+"px",width:c}),e.removeModalStylesOnHide=!0}e.$container.css({position:"fixed",top:t+"px",left:h+"px"})},s.prototype.open=function(){if(c(this.$select)){if(this.enteredText&&(this.enteredText="",this.$input.val(""),this.search()),"function"==typeof this.options.events.beforeOpen&&this.options.events.beforeOpen.call(this),-1!=this.$select[0].selectedIndex){var t=this.data.filter(function(t){return t.id===this.$select[0].selectedIndex},this);(t=t[0])&&this.activateOption(t,!0)}this.$container.css({width:this.$select.outerWidth()+4,top:-5}),this.options.flippable?(p(document).click(),this.$container.show(),this.calculateFlipPosition()):this.$container.show(),this.options.defaultInputFocus&&this.$input.focus(),this.isOpening=!0,"function"==typeof this.options.events.open&&this.options.events.open.call(this)}},s.prototype.close=function(){"function"==typeof this.options.events.beforeClose&&this.options.events.beforeClose.call(this),this.$container.hide();var t=this;setTimeout(function(){t.$input.blur()},0),"function"==typeof this.options.events.close&&this.options.events.close.call(this)},s.prototype.optionClick=function(t){var e=p(t.currentTarget);e.is("mark")&&(e=e.parent()),this.choseOption(e),this.options.alwaysOpen||this.options.multiple||this.close()},s.prototype.documentClick=function(t){if(this.isOpening)this.isOpening=!1;else if(p(t.target)!=this.$overlay&&this.$container.is(":visible"))if(this.$container.is(p(t.target).closest("[container]")));else if(this.close(),this.removeModalStylesOnHide){var e={transform:"",top:"",left:""};self.removeModalWidthOnHide&&(e.width=""),this.$parentModal.css(e)}},s.prototype.highlight=function(t,e,i){if(t||e){if(c(e))if(t){for(var s=i.toLowerCase(),n=e.text().toLowerCase(),o=e.find("[zs-dropdown-option]").text(),h=n.indexOf(s),a=s.length,l="";-1<h;)l+=o.substr(0,h)+"<mark>"+o.substr(h,a)+"</mark>",n=n.substr(h+a,n.length-1),o=o.substr(h+a,o.length-1),h=n.indexOf(s);l+=o,e.find("[zs-dropdown-option]").html(l)}else e.find("[zs-dropdown-option]").html(e.text())}else this.$nav.find("mark").each(function(){p(this).parent().html(p(this).parent().text())})},s.prototype.update=function(){this.readOptions(),-1!=this.$select[0].selectedIndex&&this.activateOption(this.data[this.$select[0].selectedIndex])},s.prototype.locateOption=function(t){return p(this.$nav[0].querySelector('a[index="'+t.id+'"]'))},s.prototype.search=function(t){if(t=t||this.$input.val(),this.$nav.html(""),t){var e,i=[],s=o.match;"function"==typeof this.options.match&&(s=this.options.match);for(var n=0;n<this.data.length;n++)e=this.data[n],s.call(this,e,t)&&i.push(e);for(n=i.length-1;0<=n;n--)0<n&&i[n].group&&i[n-1].group?i.splice(n-1,1):i[n].group&&n==i.length-1&&i.splice(n,1);this.renderOptions({data:i,highlight:t,selectFirst:!0})}else this.renderOptions({data:this.data})},s.prototype.up=function(){var t,e;this.data&&this.data.length&&c(t=c(e=this.$selected)?e.prevAll(":not([disabled]):visible:first"):this.$nav.children(":not([disabled]):visible:last"))&&this.selectOption(t,!0)},s.prototype.down=function(){var t,e;this.data&&this.data.length&&c(t=c(e=this.$selected)?e.nextAll(":not([disabled]):visible:first"):this.$nav.children(":not([disabled]):visible:first"))&&this.selectOption(t,!0)},s.prototype.onKeyUp=function(t){switch(t.keyCode){case 8:break;case 27:case 9:t.preventDefault(),t.stopPropagation();break;case 37:case 39:case 16:case 91:case 17:break;case 38:t.preventDefault(),t.stopPropagation(),this.up();break;case 40:t.preventDefault(),t.stopPropagation(),this.down()}this.enteredText!=this.$input.val()&&(this.enteredText&&this.selectOption(!1),this.enteredText=this.$input.val(),this.search())},s.prototype.onKeyDown=function(t){return 13===t.keyCode&&this.$selected&&this.$selected[0].hasAttribute("index")&&!this.$selected[0].hasAttribute("disabled")&&(this.$input.is(":visible")&&this.choseOption(this.$selected),this.options.alwaysOpen||this.options.multiple||this.close()),!0},s.prototype.render=function(){var e=this;if(this.enteredText="",this.options.alwaysOpen){this.$container=p('<div class="zs-search-dropdown zs-menu" container><p class="zs-input-icon zs-icon-search" style="display:none;"><input input type="text" class="zs-input"/></p><nav options></nav></div>'),this.$select.parent().is(".zs-select")?this.$parent=this.$select.parent():this.$parent=this.$select,this.$parent.css({position:"relative"}),this.$overlay=p("<div overlay></div>").css({display:"none",top:0,left:0,right:0,bottom:0}),this.$select.is(this.$parent)?(this.$container.css({top:0,left:0,width:"100%"}),this.$select.after(this.$overlay).after(this.$container),this.$select.parent().addClass("zs-open-dropdown")):(this.$container.css({top:0,left:0,width:this.$select.outerWidth()+4}),this.$parent.append(this.$overlay).append(this.$container).addClass("zs-open-dropdown")),this.$input=this.$container.find("[input]"),this.$input.on("keyup",this.onKeyUp.bind(this)),this.$input.on("blur",this.onKeyUp.bind(this)),this.$input.on("paste",this.onKeyUp.bind(this)),this.$input.on("change",this.onKeyUp.bind(this)),this.$nav=this.$container.find("[options]"),this.$nav.on("keyup",this.onKeyUp.bind(this)),this.$select.hide();var t=this.destroy.bind(this);this.$select[0].addEventListener?this.$select[0].addEventListener("DOMNodeRemoved",t):this.$select[0].attachEvent&&this.$select[0].attachEvent("DOMNodeRemoved",t),this.readOptions()}else{var i;this.$container=p('<div class="zs-search-dropdown zs-menu" container style="display:none;position:absolute"><p class="zs-input-icon zs-icon-search"><input input type="text" class="zs-input"/></p><nav options></nav></div>'),this.documentClickBind=this.documentClick.bind(this),p(document).on("click touchstart",this.documentClickBind),this.options.hideOnScroll&&(window.navigator&&window.navigator.userAgent.match(/iPad/i)?p(document).on("mousewheel DOMMouseScroll touchmove",this.documentClickBind):p(document).on("mousewheel DOMMouseScroll scroll",this.documentClickBind)),this.$select.parent().is(".zs-select")?this.$parent=this.$select.parent():this.$parent=this.$select,this.$parent.css({position:"relative"}),this.$overlay=p("<div overlay></div>").css({top:0,left:0,right:0,bottom:0}).appendTo(this.$parent).click(function(){e.open()}).text(this.options.emptyText),i=this.$select.offset(),this.$container.css({top:i.top-2,left:i.left-2,width:this.$select.outerWidth()+4}),this.$container.css({top:0,left:0,width:this.$select.outerWidth()+4}),this.$container.appendTo(this.$parent),this.$input=this.$container.find("[input]"),this.$input.on("keyup",this.onKeyUp.bind(this)),this.$input.on("blur",this.onKeyUp.bind(this)),this.$input.on("paste",this.onKeyUp.bind(this)),this.$input.on("change",this.onKeyUp.bind(this)),this.$nav=this.$container.find("[options]"),this.$nav.on("keyup",this.onKeyUp.bind(this));t=this.destroy.bind(this);this.$select[0].addEventListener?this.$select[0].addEventListener("DOMNodeRemoved",t):this.$select[0].attachEvent&&this.$select[0].attachEvent("DOMNodeRemoved",t),this.readOptions();e=this;this.$input.on("focus",function(){if(window.navigator&&window.navigator.userAgent.match(/iPad/i)){var t=e.$container.outerHeight()+e.$container.offset().top;p(window).outerHeight(),p(window).scrollTop();if(t<("portrait"===(90==Math.abs(window.orientation)?"landscape":"portrait")?2*p(window).outerHeight()/3+p(window).scrollTop():p(window).outerHeight()/2+p(window).scrollTop()))return;p("html, body").animate({scrollTop:p(this).offset().top-20},1e3)}})}this.$select.hide(),this.$select.on("change",this.select.bind(this)),this.$input.on("keydown",this.onKeyDown.bind(this)),this.$nav.on("keydown",this.onKeyDown.bind(this)),-1!=this.$select[0].selectedIndex&&this.$select.find("[selected]").each(function(){e.$nav.find("[index = "+this.index+"]").trigger("click")}),this.select()},s.prototype.select=function(t){var e;if(this.options.multiple){for(var i in e=[],this.selectedMap){(s=(s=this.data.filter(function(t){return t.id==i},this))[0])&&e.push(s.text)}e=e.join(", ")}else if(this.data[this.$select[0].selectedIndex]&&this.data[this.$select[0].selectedIndex].text){var s;(s=(s=this.data.filter(function(t){return t.id===this.$select[0].selectedIndex&&!t.isPlaceholder},this))[0])&&(e=s.text)}return this.options.updateOverlayText.call(this,e),e},s.prototype.getOverlayText=function(){return this.$overlay.text()},s.prototype.format=function(t,e){return"function"==typeof this.options.format[t]?this.options.format[t].call(this,e):o.format[t].call(this,e)},s.prototype.destroy=function(){this.$nav.off(),this.$nav.find(">a").off(),this.$input.off(),this.$overlay.off(),this.documentClickBind&&p(document).off("click touchstart",this.documentClickBind),this.$overlay.remove(),this.$container.remove(),c(this.$select)&&this.$select.removeData("zsSearchDropdown")},s.prototype.configure=function(t){void 0===t.minOptionsForSearch&&(t.minOptionsForSearch=o.minOptionsForSearch),t.multiple&&this.$select.prop("multiple",!0),t&&(this.options=t)},s.prototype.mapSelection=function(t,e){this.selectedMap||(this.selectedMap={}),t&&(void 0===e?void 0!==this.selectedMap[t]?(this._allSelected=!1,this.toggleSelectAllButton(),this.$select[0].options[t].selected=!1,delete this.selectedMap[t]):(this.$select[0].options[t].selected=!0,this.selectedMap[t]=t,this.$select[0].length==Object.keys(this.selectedMap).length&&(this._allSelected=!0,this.toggleSelectAllButton())):(this.$select[0].options[t].selected=e)||delete this.selectedMap[t])},s.prototype.clearAllSelection=function(){var i=this;if(i.options.multiple){i.$input.val(""),i.$input.trigger("change");var t=this.$nav.find("[active]");p.each(t,function(t,e){i.choseOption(p(e))})}},s.prototype.toggleSelectAllButton=function(){if(this.options.addSelectAll){var t=this.$nav.find("a").first();t.attr("index")||(this.options.addCheckboxes?t.find("input").prop("checked",!!this._allSelected):t.text(this._allSelected?this.options.deselectAllText:this.options.selectAllText))}},s.prototype.toggleAll=function(){var t=this;this.$nav.find("a").each(function(){p(this).attr("index")&&(t._allSelected?(p(this).removeAttr("active"),p(this).find("input").prop("checked",!1)):(p(this).attr("active",""),p(this).find("input").prop("checked",!0)))});var e=this.$select[0].options;this.selectedMap={};for(var i=0;i<e.length;i++)this._allSelected?e[i].selected=!1:(e[i].selected=!0,this.selectedMap[i]=i);this._allSelected=!this._allSelected,this.toggleSelectAllButton(),this.options.alwaysOpen||this.$select.trigger("change"),"function"==typeof this.options.events.change&&this.options.events.change.call(this)},p.fn.zsSearchDropdown=function(e){if(this!=p.fn){var i=p.isPlainObject(e)||!e?p.extend(!0,{},o,e):p.extend(!0,{},o);return this.each(function(){var t=p(this).data("zsSearchDropdown");if(t)if("string"==p.type(e))switch(e){case"destroy":t.destroy(p(this));break;case"update":t.update()}else t.configure(p.extend(!0,t.options,e)),t.update();else"string"==p.type(e)||p(this).data("zsSearchDropdown",new s(i,p(this)))})}p.extend(s.prototype,e)}}(jQuery);
//# sourceMappingURL=jquery.zsSearchDropdown.min.js.map